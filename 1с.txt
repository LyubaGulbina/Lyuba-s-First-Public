&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ЗаполнитьДанныеДиаграмм ();
	
	
КонецПроцедуры

&НаСервере  

Процедура  	ЗаполнитьДанныеДиаграмм ();

	ЗаполнитьДиаграммуОстаткиНаСчетах (); 
	ЗаполнитьДиаграммуТопРасходы ();
	
КонецПроцедуры  

&НаСервере  

Процедура ЗаполнитьДиаграммуТопРасходы ();  
	
	ТопРасходы.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст ="ВЫБРАТЬ ПЕРВЫЕ 10
	              |	РасходыОбороты.Номенклатура КАК Номенклатура,
	              |	РасходыОбороты.СуммаОборот КАК СуммаОборот
	              |ИЗ
	              |	РегистрНакопления.Расходы.Обороты КАК РасходыОбороты
	              |ГДЕ
	              |	РасходыОбороты.Номенклатура <> ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)
	              |
	              |УПОРЯДОЧИТЬ ПО
	              |	СуммаОборот УБЫВ";
	
	Серия = ТопРасходы.Точки.Вставить("Сумма расходов (руб)");
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий () Цикл 
		
		Точка = ТопРасходы.УстановитьТочку (Выборка.Номенклатура);
		ОстаткиНаСчетах.УстановитьЗначение(Точка, Серия, Выборка.СуммаОборот);
		
		
		КонецЦикла;
	
	КонецПроцедуры
	
Процедура ЗаполнитьДиаграммуОстаткиНаСчетах ();  
	
	ОстаткиНаСчетах.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст ="ВЫБРАТЬ
	              |	ЛичныеСчетаОстатки.Счет КАК Счет,
	              |	ЛичныеСчетаОстатки.СуммаОстаток КАК СуммаОстаток
	              |ИЗ
	              |	РегистрНакопления.ЛичныеСчета.Остатки КАК ЛичныеСчетаОстатки";
	
	Точка = ОстаткиНаСчетах.Точки.Добавить ("Остаток на счете (руб)");
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий () Цикл 
		
		Серия = ОстаткиНаСчетах.УстановитьСерию (Выборка.Счет);
		ОстаткиНаСчетах.УстановитьЗначение(Точка, Серия, Выборка.СуммаОстаток); 
	КонецЦикла;
	КонецПроцедуры


Функция СуммаВВалюте (СуммаВРублях, Валюта, Дата) Экспорт    
	
	Если Валюта = Справочники.Валюты.РоссийскийРубль Тогда
		Возврат СуммаВРублях;  
		
	КонецЕсли;    
	
	Отбор = Новый Структура;
	Отбор.Вставить ("Валюта", Валюта);
	
	
	ПоследниеДанные = ПолучитьПоследнее (Дата, Отбор); 
	
	Возврат СуммаВРублях*ПоследниеДанные.Кратность/ПоследниеДанные.Курс;
	
КонецФункции  

Функция СуммаВРублях (СуммаВВалюте, Валюта, Дата) Экспорт    
	
	Если Валюта = Справочники.Валюты.РоссийскийРубль Тогда
		Возврат СуммаВВалюте;  
		
	КонецЕсли;    
	
	Отбор = Новый Структура;
	Отбор.Вставить ("Валюта", Валюта);
	
	
	ПоследниеДанные = ПолучитьПоследнее (Дата, Отбор); 
	
	Возврат СуммаВВалюте*ПоследниеДанные.Курс/ПоследниеДанные.Кратность;
	
	КонецФункции
